(()=>{function g(e,t){return new Promise(r=>e.addEventListener(t,r,{once:!0}))}var x=e=>new Promise(t=>setTimeout(t,e));function S(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return alert("AudioContext not supported");navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(e){let t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t||alert("getUserMedia is not implemented in this browser"),new Promise(function(r,l){t.call(navigator,e,r,l)})})}var E=(e,...t)=>{e.classList.remove(...t),e.offsetWidth,e.classList.add(...t)};var C=440,L=69,q=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function P(e){let t=F(e);return{value:t%12,index:t,name:q[t%12],cents:G(e,t),octave:Math.floor(t/12)-1,frequency:e}}function F(e){let t=12*(Math.log(e/C)/Math.log(2));return Math.round(t)+L}function U(e){return C*2**((e-L)/12)}function G(e,t){return Math.floor(1200*Math.log(e/U(t))/Math.log(2))}console.log("Licensed under AGPL-3.0: https://github.com/onlinemictest/pitch-detector");var K=24,B=4096,I="animate"in Element.prototype?e=>e.animate([{transform:"scale(0.33)"},{transform:"scale(1)"}],{duration:125,easing:"ease"}):e=>E(e,"blob-animation"),O="animate"in Element.prototype?e=>e.animate([{transform:"scale(3) "},{transform:"scale(1)"}],{duration:125,easing:"ease"}):e=>E(e,"shrink-animation");S();if(!("WebAssembly"in window)||!("AudioContext"in window)||!("createAnalyser"in AudioContext.prototype)||!("createScriptProcessor"in AudioContext.prototype)){if(!("WebAssembly"in window))throw alert("Browser not supported: 'WebAssembly' is not defined");if(!("AudioContext"in window))throw alert("Browser not supported: 'AudioContext' is not defined");if(!("createAnalyser"in AudioContext.prototype))throw alert("Browser not supported: 'AudioContext.prototype.createAnalyser' is not defined");if(!("createScriptProcessor"in AudioContext.prototype))throw alert("Browser not supported: 'AudioContext.prototype.createScriptProcessor' is not defined")}Aubio().then(({Pitch:e})=>{var M,T,b;let t=document.getElementById("pitch-detector"),r=document.getElementById("pitch-wheel-svg"),l=(M=document.getElementById("pitch-freq"))==null?void 0:M.querySelector(".freq"),v=(T=document.getElementById("pitch-freq"))==null?void 0:T.querySelector(".note"),h=(b=document.getElementById("pitch-freq"))==null?void 0:b.querySelector(".octave"),n=document.getElementById("audio-start"),i=document.getElementById("audio-pause"),d=document.getElementById("circle-text-play"),m=document.getElementById("circle-text-error"),u=document.getElementById("pitch-freq-text");if(!t||!r||!l||!v||!h||!n||!i||!d||!m||!u)return alert("Expected HTML element missing");let o,p,s,w,y;i.addEventListener("click",async()=>{n.style.display="block",i.style.display="none",u.style.opacity="0",d.style.display="block",I(n),await Promise.race([g(n,"animationend"),x(250)]),s.disconnect(o.destination),p.disconnect(s),o.close(),y.getTracks().forEach(a=>a.stop())}),n.addEventListener("click",async()=>{t.scrollIntoView({behavior:"smooth",block:"center"}),n.style.display="none",i.style.display="block",d.style.display="none",m.style.display="none",O(i),await Promise.race([g(i,"animationend"),x(250)]),o=new AudioContext,p=o.createAnalyser(),s=o.createScriptProcessor(B,1,1),w=new e("default",B,1,o.sampleRate);try{y=await navigator.mediaDevices.getUserMedia({audio:!0}),o.createMediaStreamSource(y).connect(p),p.connect(s),s.connect(o.destination),u.style.opacity="1";let a=0;s.addEventListener("audioprocess",N=>{let k=w.do(N.inputBuffer.getChannelData(0)),c=P(k),A=360/K,f=c.index*A+c.cents/100*A;if(c.name){let D=Math.trunc(Math.abs(a-f));a=f;let H=(D+25)*15;l.innerText=c.frequency.toFixed(1),v.innerText=c.name,h.innerText=c.octave.toString(),r.style.transition=`transform ${H}ms ease`,r.style.transform=`rotate(-${f}deg)`}})}catch(a){n.style.display="block",i.style.display="none",u.style.opacity="0",I(n),m.innerText=a.message,d.style.display="none",m.style.display="block"}})});})();
/**
 * Copyright (C) 2021 Online Mic Test
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 * @license
 */
