(()=>{var g=(e,t,n)=>e&&(e[t]=n);function x(e,t){return new Promise(n=>e.addEventListener(t,n,{once:!0}))}var E=e=>new Promise(t=>setTimeout(t,e));function C(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return alert("AudioContext not supported");navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(e){let t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t||alert("getUserMedia is not implemented in this browser"),new Promise(function(n,d){t.call(navigator,e,n,d)})})}var h=(e,...t)=>{e.classList.remove(...t),e.offsetWidth,e.classList.add(...t)};var L=440,P=69,F=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function B(e){let t=G(e);return{value:t%12,index:t,name:F[t%12],cents:U(e,t),octave:Math.floor(t/12)-1,frequency:e}}function G(e){let t=12*(Math.log(e/L)/Math.log(2));return Math.round(t)+P}function K(e){return L*2**((e-P)/12)}function U(e,t){return Math.floor(1200*Math.log(e/K(t))/Math.log(2))}console.log("Licensed under AGPL-3.0: https://github.com/onlinemictest/pitch-detector");var O=24,I=4096,q="animate"in Element.prototype?e=>e.animate([{transform:"scale(0.33)"},{transform:"scale(1)"}],{duration:125,easing:"ease"}):e=>h(e,"blob-animation"),W="animate"in Element.prototype?e=>e.animate([{transform:"scale(3) "},{transform:"scale(1)"}],{duration:125,easing:"ease"}):e=>h(e,"shrink-animation");C();if(!("WebAssembly"in window)||!("AudioContext"in window)||!("createAnalyser"in AudioContext.prototype)||!("createScriptProcessor"in AudioContext.prototype)){if(!("WebAssembly"in window))throw alert("Browser not supported: 'WebAssembly' is not defined");if(!("AudioContext"in window))throw alert("Browser not supported: 'AudioContext' is not defined");if(!("createAnalyser"in AudioContext.prototype))throw alert("Browser not supported: 'AudioContext.prototype.createAnalyser' is not defined");if(!("createScriptProcessor"in AudioContext.prototype))throw alert("Browser not supported: 'AudioContext.prototype.createScriptProcessor' is not defined")}Aubio().then(({Pitch:e})=>{var T,b,A;let t=document.getElementById("pitch-detector"),n=document.getElementById("pitch-wheel-svg"),d=(T=document.getElementById("pitch-freq"))==null?void 0:T.querySelector(".freq"),v=(b=document.getElementById("pitch-freq"))==null?void 0:b.querySelector(".note"),w=(A=document.getElementById("pitch-freq"))==null?void 0:A.querySelector(".octave"),o=document.getElementById("audio-start"),i=document.getElementById("audio-pause"),u=document.getElementById("circle-text-error"),m=document.getElementById("pitch-freq-text"),s=document.querySelector(".tuners-privacy-box");if(!t||!n||!d||!v||!w||!o||!i||!u||!m)return alert("Expected HTML element missing");let r,p,a,M,y;i.addEventListener("click",async()=>{o.style.display="block",i.style.display="none",m.style.opacity="0",g(s==null?void 0:s.style,"visibility",""),q(o),await Promise.race([x(o,"animationend"),E(250)]),a.disconnect(r.destination),p.disconnect(a),r.close(),y.getTracks().forEach(c=>c.stop())}),o.addEventListener("click",async()=>{t.scrollIntoView({behavior:"smooth",block:"center"}),o.style.display="none",i.style.display="block",u.style.display="none",g(s==null?void 0:s.style,"visibility","hidden"),W(i),await Promise.race([x(i,"animationend"),E(250)]),r=new AudioContext,p=r.createAnalyser(),a=r.createScriptProcessor(I,1,1),M=new e("default",I,1,r.sampleRate);try{y=await navigator.mediaDevices.getUserMedia({audio:!0}),r.createMediaStreamSource(y).connect(p),p.connect(a),a.connect(r.destination),m.style.opacity="1";let c=0;a.addEventListener("audioprocess",D=>{let H=M.do(D.inputBuffer.getChannelData(0)),l=B(H),S=360/O,f=l.index*S+l.cents/100*S;if(l.name){let k=Math.trunc(Math.abs(c-f));c=f;let N=(k+25)*15;d.innerText=l.frequency.toFixed(1),v.innerText=l.name,w.innerText=l.octave.toString(),n.style.transition=`transform ${N}ms ease`,n.style.transform=`rotate(-${f}deg)`}})}catch(c){o.style.display="block",i.style.display="none",m.style.opacity="0",q(o),u.innerText=c.message,u.style.display="block"}})});})();
/**
 * Copyright (C) 2021 Online Mic Test
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 * @license
 */
